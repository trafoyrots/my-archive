<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Retro Game Archive</title>
    <link rel="stylesheet" href="https://js-dos.com/v7/build/releases/latest/js-dos/js-dos.css">
    <script src="https://js-dos.com/v7/build/releases/latest/js-dos/js-dos.js"></script>
    <style>
        /* 화면이 깨지지 않도록 강제 고정하는 스타일 */
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; color: #fff; overflow: hidden; }
        #app { display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; }
        
        /* 로그인/로비 박스 */
        .box { background: #1a1a1a; padding: 40px; border: 1px solid #333; border-radius: 8px; text-align: center; min-width: 300px; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; background: #222; border: 1px solid #444; color: #fff; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #3f51b5; color: #fff; border: none; cursor: pointer; font-weight: bold; }
        
        /* 에뮬레이터 캔버스 고정 */
        #jsdos-container { display: none; width: 100vw; height: 100vh; position: fixed; inset: 0; z-index: 100; }
        #dos-canvas { width: 100% !important; height: 100% !important; }
    </style>
</head>
<body>

    <div id="app">
        <div id="login-box" class="box">
            <h2 style="margin-top:0">SYSTEM ACCESS</h2>
            <input type="password" id="pw" placeholder="Password" onkeypress="if(event.keyCode==13) doLogin()">
            <button onclick="doLogin()">LOGIN</button>
        </div>

        <div id="lobby" class="box" style="display:none">
            <h2>GAME LIST</h2>
            <div style="padding:20px; border:1px solid #555; cursor:pointer;" onclick="start('./games/uw2.zip')">
                대항해시대 2 실행
            </div>
        </div>
    </div>

    <div id="jsdos-container">
        <canvas id="dos-canvas"></canvas>
    </div>

    <script>
        function doLogin() {
            if (document.getElementById("pw").value === "1234") {
                document.getElementById("login-box").style.display = "none";
                document.getElementById("lobby").style.display = "block";
            }
        }

        function start(relPath) {
            document.getElementById("app").style.display = "none";
            document.getElementById("jsdos-container").style.display = "block";

            // 경로를 절대 주소로 강제 변환
            const gameUrl = new URL(relPath, window.location.href).href;
            console.log("Loading:", gameUrl);

            Dos(document.getElementById("dos-canvas"), {
                wdosboxUrl: "https://js-dos.com/v7/build/releases/latest/js-dos/wdosbox.js"
            }).run(gameUrl).catch(err => {
                alert("실행 실패: " + err.message);
                location.reload();
            });
        }
    </script>
</body>
</html>
